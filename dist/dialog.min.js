!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define("dialog",["jquery"],e):t.Dialog=e(t.jQuery)}(this,function(t){"use strict";function e(t){return T.call(t)}function n(t){return"[object Function]"===e(t)}function o(t){return"[object String]"===e(t)}function r(t){return"[object Number]"===e(t)}function a(t){return!!n(t)&&M.test(n.toString())}function i(t,e,n,o){Array.isArray(n)||(n=!1);var r;for(var a in e)if(e.hasOwnProperty(a)){if(n&&(r=n.indexOf(a),o?r===-1:r!==-1))continue;"prototype"!==a&&(t[a]=e[a])}return t}function c(){}function s(t,e,n){var o=e.prototype;return j?j(t.prototype,o):O?t.prototype=O(o):(c.prototype=o,t.prototype=new c,c.prototype=null),n&&i(t.prototype,n),t.prototype.constructor=t,t}function l(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);default:return t.apply(e,n)}}function u(t,e){var n=P?P(t,null):t.currentStyle;return{getPropertyValue:function(t){if(n)return n.getPropertyValue?n.getPropertyValue(t):(t=t.replace(/-(\w)/gi,function(t,e){return e.toUpperCase()}),n.getAttribute?n.getAttribute(t):n[t])}}}function f(t,e){return o(t)?e?t.replace(H,function(t,n){return e.hasOwnProperty(n)?e[n]:n}):t:""}function d(){}function m(){var e=this;e.destroyed=!1,e.node=document.createElement("div"),e.__node=t(e.node).attr("tabindex","-1").on("focusin",function(){e.focus()})}function v(t){for(var e in t)if(t.hasOwnProperty(e)&&void 0!==F[e])return e}function p(t){return 1e3*Number(t.slice(0,-1))}function h(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map(function(e,n){return p(e)+p(t[n])}))}function _(t){return t?t.split(", "):[]}function y(t){var e,n,o,r=u(t),a=_(r.getPropertyValue(D+"-delay")),i=_(r.getPropertyValue(D+"-duration")),c=h(a,i),s=_(r.getPropertyValue(q+"-delay")),l=_(r.getPropertyValue(q+"-duration")),f=h(s,l);return o=Math.max(c,f),e=o>0?c>f?D:q:null,n=e?e===D?i.length:l.length:0,{effect:e,count:n,timeout:o}}function g(t,e){if(!q&&!D)return e();var n=t[0],o=y(n),r=o.effect;if(!r)return e();var a=0,i=o.count,c=o.timeout,s=r===D?W[D]:I[q],l=function(){t.off(s,u),e()},u=function(t){t.target===n&&++a>=i&&l()};setTimeout(function(){a<i&&l()},c+1),t.on(s,u)}function b(){var t=this;m.call(t),t.__node.css({display:"none",position:"absolute",outline:0,top:0,left:0})}function w(t,e){var a=this;if(b.call(a),a.options=e=i({id:null,buttons:[],anchor:null,fixed:!1,keyboard:!0,title:"弹出消息",skin:"ui-dialog",align:"bottom left"},e),o(e.id)){if(B[e.id])return a.__render(t,e);B[e.id]=a}var c=f(X,{className:a.className});a.__node.on("click",c,function(){var t=$(this),o=t.attr("role"),i=t.attr("data-action");switch(o){case Q:"close"===i&&x(27,a);break;case R:var c=e.buttons?e.buttons[i]:null;if(c){n(c.action)&&c.action.call(a),r(c.which)&&x(c.which,a,c);break}}}),a.__render(t,e)}function x(t,e,o){Array.isArray(e.options.buttons)&&e.options.buttons.forEach(function(r){r.which===t&&r!==o&&n(r.action)&&r.action.call(e)}),27===t&&e.close()}t="default"in t?t["default"]:t;var N=Object.prototype,A=Array.prototype,k=Function.prototype,T=N.toString,E=k.toString,M="";M+=E.call(Function),M=M.replace(/([.*+?^=!:$(){}|[\]\/\\])/g,"\\$1"),M=M.replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),M="^"+M+"$",M=new RegExp(M);var z=t(window),C=t(document),j=Object.setPrototypeOf;a(j)||(j=!1);var O=Object.create;a(O)||(O=!1);var P=window.getComputedStyle,H=/{{([a-z]*)}}/gi,L=A.slice;d.prototype={on:function(t,e,n){var o=this,r=o.__events||(o.__events={});return n=arguments.length<3?o:n,(r[t]||(r[t]=[])).push({fn:e,context:n}),o},once:function(t,e,n){function o(){r.off(t,o),l(e,this,arguments)}var r=this;return r.on(t,o,n)},emit:function(t){for(var e,n,o,r=this,a=L.call(arguments,1),i=r.__events||(r.__events={}),c=i[t]||[],s=0,u=c.length;s<u;s++)n=c[s],e=l(n.fn,n.context,a),o!==!1&&(o=e);return o},off:function(t,e,n){var o=this,r=o.__events||(o.__events={}),a=arguments.length;switch(a){case 0:o.__events={};break;case 1:delete r[t];break;default:if(e){var i=r[t];if(i){n=a<3?o:n,a=i.length;for(var c=0;c<a;c++)if(evts[c].fn===e&&evts[c].fn.context===n){i.splice(c,1);break}i.length||delete r[t]}}}return o}};var V=1024,S={alloc:[],node:t('<div tabindex="0"></div>').css({position:"fixed",top:0,left:0,width:"100%",height:"100%",userSelect:"none"}),shim:t('<div tabindex="0"></div>').css({width:0,height:0,opacity:0}),zIndex:function(t){t=Math.max(0,--t),S.node.css("z-index",t)},attach:function(t){var e=t.node,n=t.className+"-backdrop";S.node.addClass(n).insertBefore(e),S.shim.insertAfter(e)},show:function(t){var e=S.alloc;e.indexOf(t)===-1&&(S.attach(t),e.push(t))},hide:function(t){S.alloc=S.alloc.filter(function(e){return t!==e});var e=S.alloc.length;0===e?(S.node.remove(),S.shim.remove()):(t=S.alloc[e-1],S.zIndex(t.zIndex),S.attach(t))}};m.active=null,m.zIndex=V,m.backdrop=S,m.cleanActive=function(t){m.active===t&&(m.active=null)},C.on("focusin",function(t){var e=m.active;if(e&&e.modal){var n=t.target,o=e.node;n===o||o.contains(n)||e.focus()}}),s(m,d,{node:null,destroyed:!0,open:!1,autofocus:!0,modal:!1,innerHTML:"",className:"ui-layer",constructor:m,focus:function(){var t=this;if(t.destroyed||!t.open)return t;var e=t.node,n=t.__node,o=m.active;if(o&&o!==t&&o.blur(!1),!e.contains(t.__getActive())){var r=n.find("[autofocus]")[0];!t.__autofocus&&r?t.__autofocus=!0:r=e,t.__focus(r),o=m.active}if(o!==t){var a=t.zIndex=m.zIndex++;S.zIndex(a),n.css("zIndex",a),n.addClass(t.className+"-focus"),t.emit("focus"),m.active=t}return t},blur:function(){var t=this;if(t.destroyed||!t.open)return t;var e=arguments[0];return t.__cleanActive(),e!==!1&&t.__focus(t.__activeElement),t.__autofocus=!1,t.__node.removeClass(t.className+"-focus"),t.emit("blur"),t},__focus:function(t){try{this.autofocus&&!/^iframe$/i.test(t.nodeName)&&t.focus()}catch(e){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument,n=e&&e.activeElement||t;return n}catch(o){}},__cleanActive:function(){m.active===this&&(m.active=null)}});var F=document.documentElement.style,I={animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",KhtmlAnimation:"khtmlAnimationEnd"},W={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",KhtmlTransition:"khtmlTransitionEnd"},q=v(I),D=v(W),K=/\s+/;s(b,m,{returnValue:void 0,anchor:null,fixed:!1,align:"bottom left",className:"ui-dialog",constructor:b,__show:function(t){var e=this;if(e.destroyed)return e;var n=e.__node;return e.open=!0,e.anchor=t||null,e.__activeElement=e.__getActive(),e.__ready||(n.addClass(e.className).css("position",e.fixed?"fixed":"absolute"),n.appendTo(document.body),e.__ready=!0),e.__innerHTML!==e.innerHTML&&(n.html(e.innerHTML),e.__innerHTML=e.innerHTML),e.modal&&(m.backdrop.show(e),n.addClass(e.className+"-modal")),n.attr("role",e.modal?"alertdialog":"dialog").removeClass(e.className+"-close").addClass(e.className+"-show").show(),e.reset(),e.emit("show"),e.focus(),e},show:function(t){var e=this;if(e.modal){var n=e.__node;e.open&&m.backdrop.hide(e),n.removeClass(e.className+"-modal")}return e.modal=!1,e.__show(t)},showModal:function(t){var e=this;e.__node;return e.modal=!0,e.__show(t)},close:function(t){var e=this;if(e.destroyed||!e.open)return e;if(e.emit("beforeclose")===!1)return e;void 0!==t&&(e.returnValue=t);var n=(e.node,e.__node);return n.removeClass(e.className+"-show").addClass(e.className+"-close"),e.blur(),g(n,function(){n.hide(),e.modal&&m.backdrop.hide(e),e.open=!1,e.emit("close")}),e},remove:function(){var t=this;if(t.destroyed)return t;if(t.emit("beforeremove")===!1)return t;t.__cleanActive(),t.open&&t.modal&&m.backdrop.hide(t),t.__node.off("focusin").remove(),t.destroyed=!0,t.emit("remove");for(var e in t)delete t[e];return t},reset:function(){var t=this;if(t.destroyed||!t.open)return t;var e=t.__align;e&&(t.__node.removeClass(e),t.__align=null);var n=t.anchor;return n?t.__follow(n):t.__center(),t.emit("reset"),t},__center:function(){var t=this,e=t.__node,n=t.fixed,o=z.width(),r=z.height(),a=n?0:C.scrollLeft(),i=n?0:C.scrollTop(),c=e.outerWidth(),s=e.outerHeight(),l=382*(r-s)/1e3+i,u=(o-c)/2+a;e.css({top:Math.max(parseFloat(l),i),left:Math.max(parseFloat(u),a)})},__follow:function(e){var n=this,o=n.__node;if(e=e.parentNode&&t(e),!e||!e.length)return n.__center();if(e){var r=e.offset();if(r.left*r.top<0)return n.__center()}var a=n.fixed,i=z.width(),c=z.height(),s=C.scrollLeft(),l=C.scrollTop(),u=o.outerWidth(),f=o.outerHeight(),d=e?e.outerWidth():0,m=e?e.outerHeight():0,r=n.__offset(e[0]),v=r.left,p=r.top,h=a?v-s:v,_=a?p-l:p,y=a?0:l,g=a?0:s,b=y+c-f,w=g+i-u,x={},N=n.align.split(K),A=n.className+"-",k={top:"bottom",bottom:"top",left:"right",right:"left"},T={top:"top",bottom:"top",left:"left",right:"left"},E=[{top:_-f,bottom:_+m,left:h-u,right:h+d},{top:_,bottom:_-f+m,left:h,right:h-u+d}],M={top:_+m/2-f/2,left:h+d/2-u/2},j={left:[g,w],top:[y,b]};N.forEach(function(t,e){E[e][t]>j[T[t]][1]&&(t=N[e]=k[t]),E[e][t]<j[T[t]][0]&&(N[e]=k[t])}),N[1]||(T[N[1]]="left"===T[N[0]]?"top":"left",E[1][N[1]]=M[T[N[1]]]),A+=N.join("-")+" "+n.className+"-follow",n.__align=A,o.addClass(A),x[T[N[0]]]=parseFloat(E[0][N[0]]),x[T[N[1]]]=parseFloat(E[1][N[1]]),o.css(x)},__offset:function(e){var n=e.parentNode,o=n?t(e).offset():{left:e.pageX,top:e.pageY};e=n?e:e.target;var r=e.ownerDocument,a=r.defaultView||r.parentWindow;if(a==window)return o;var i=a.frameElement;r=t(r);var c=r.scrollLeft(),s=r.scrollTop(),l=t(i).offset(),u=l.left,f=l.top;return{top:o.top+f-s,left:o.left+u-c}}});var B={},Q="handle",R="action",U='<div class="{{className}}-title">  <div class="{{className}}-caption">{{title}}</div>  <div class="{{className}}-handle">    <a href="javascript:;" title="关闭" role="'+Q+'" data-action="close" class="{{className}}-handle-close">×</a>  </div></div><div class="{{className}}-content">{{content}}</div><div class="{{className}}-action">{{buttons}}</div>',X=".{{className}}-handle [role], .{{className}}-action [role]",Y='<button class="{{className}}" type="button" role="'+R+'" title="{{label}}" data-action="{{index}}">{{label}}</button>';w.items=function(){return B},z.on("keyup",function(t){var e=m.active;if(e instanceof w&&e.options.keyboard){var n=t.which,o=$(t.target),r=o.attr("role");13===n&&r===R&&e.node.contains(t.target)||x(n,e)}});var G=b.prototype.remove;return s(w,b,{constructor:w,__render:function(t,e){var n="",r=this;return Array.isArray(e.buttons)&&e.buttons.forEach(function(t,e){n+=f(Y,{className:t.className,label:t.label,index:e})}),t=o(t)?t:"",r.innerHTML=f(U,{className:r.className,title:e.title,content:t,buttons:n}),r},set:function(t,e){},remove:function(){var t=this,e=t.options.id;G.call(t),t.destroyed&&o(e)&&delete B[e]}}),w});
//# sourceMappingURL=dialog.js.map