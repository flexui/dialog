!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("jquery")):"function"==typeof define&&define.amd?define("dialog",["jquery"],e):t.FlexUI=e(t.jQuery)}(this,function(t){"use strict";function e(t){return M.call(t)}function n(t){return"[object Function]"===e(t)}function o(t){return"[object String]"===e(t)}function i(t){return"[object Number]"===e(t)}function r(t){return!!n(t)&&j.test(O.call(t))}function a(t){return String(t).replace(/[&<>\'\"]/g,function(t){return C[t]})}function c(t,e){function n(t){return c.call({line:1,output:"",data:t,escapeHTML:a})}var o=1,i="__CONTEXT"+Date.now()+"__",r="try {\nvar "+i+" = this;\n\n"+i+".output += '"+t.replace(/<%/g,"").replace(/%>/g,"").replace(/'(?![^\x11\x13]+?\x13)/g,"\\x27").replace(/^\s*|\s*$/g,"").replace($,function(){return"';\n"+i+".line = "+ ++o+";\n"+i+".output += '\\n"}).replace(/\x11==\s*(.+?)\s*\x13/g,"' + ($1) + '").replace(/\x11=\s*(.+?)\s*\x13/g,"' + "+i+".escapeHTML($1) + '").replace(/(^|[^\w\u00c0-\uFFFF_])@(?=\w)/g,"$1"+i+".data.").replace(/(^|[^\w\u00c0-\uFFFF_])@(?=\[)/g,"$1"+i+".data").replace(/\x11\s*(.+?)\s*\x13/g,"';\n$1\n"+i+".output += '")+"';\n\nreturn "+i+".output;\n} catch (e) {\nthrow 'TemplateError: ' + e + ' (at ' + ' line ' + "+i+".line + ')';\n}",c=new Function(r.replace(new RegExp("\n"+i+".output += '';\n","g"),"\n"));return e?n(e):n}function l(t,e,n,o){Array.isArray(n)||(n=!1);var i;for(var r in e)if(e.hasOwnProperty(r)){if(n&&(i=n.indexOf(r),o?-1===i:-1!==i))continue;"prototype"!==r&&(t[r]=e[r])}return t}function s(){}function u(t,e,n){var o=e.prototype;return H?H(t.prototype,o):L?t.prototype=L(o):(s.prototype=o,t.prototype=new s,s.prototype=null),n&&l(t.prototype,n),t.prototype.constructor=t,t}function d(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2]);default:return t.apply(e,n)}}function f(t,e){var n=V?V(t,null):t.currentStyle;return{getPropertyValue:function(t){if(n)return n.getPropertyValue?n.getPropertyValue(t):(t=t.replace(/-(\w)/gi,function(t,e){return e.toUpperCase()}),n.getAttribute?n.getAttribute(t):n[t])}}}function h(t){var e=/^([+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|))(.*)$/i.exec(t);return e?e[1]+(e[2]||"px"):t}function p(){}function _(t){return i(t)&&t>0&&t!==Infinity&&(W=t),W}function v(t){return t?W++:W}function m(){var e=this;e.destroyed=!1,e.node=document.createElement("div"),e.__node=t(e.node).attr("tabindex","-1").on("focusin",function(){e!==m.active&&e.focus()})}function b(t){for(var e in t)if(t.hasOwnProperty(e)&&K[e]!==undefined)return e}function g(t){return 1e3*Number(t.slice(0,-1))}function y(t,e){for(;t.length<e.length;)t=t.concat(t);return Math.max.apply(null,e.map(function(e,n){return g(e)+g(t[n])}))}function w(t){return t?t.split(", "):[]}function x(t){var e,n,o,i=f(t),r=w(i.getPropertyValue(B+"-delay")),a=w(i.getPropertyValue(B+"-duration")),c=y(r,a),l=w(i.getPropertyValue(X+"-delay")),s=w(i.getPropertyValue(X+"-duration")),u=y(l,s);return o=Math.max(c,u),e=o>0?c>u?B:X:null,n=e?e===B?a.length:s.length:0,{effect:e,count:n,timeout:o}}function k(t,e){if(!X&&!B)return e();var n=t[0],o=x(n),i=o.effect;if(!i)return e();var r=0,a=o.count,c=o.timeout,l=i===B?U[B]:R[X],s=function(){t.off(l,u),e()},u=function(t){t.target===n&&++r>=a&&s()};setTimeout(function(){r<a&&s()},c+1),t.on(l,u)}function E(){var t=this;m.call(t),t.__node.css({top:0,left:0,display:"none",position:"absolute"})}function T(t,e){var n=this;if(!(n instanceof T))return new T(t,e);var i=(e=e||{}).id;if(i&&o(i)){var r=G[i];if(r)return r.off(),r.__initContent(t),r.__initOptions(e),r.__render(),r;n.id=i,G[i]=n}else n.id=i=String(Z++);E.call(n);var a=n.views={frame:c(Y),labelledby:c(tt,{id:i}),describedby:c(et,{id:i})};n.__node.attr("aria-labelledby",a.labelledby).attr("aria-describedby",a.describedby),n.__initContent(t),n.__initOptions(e),n.__initEvents(),n.__render()}function A(t,e,o){var i=e.which;t.forEach(function(t){t.which===i&&n(t.action)&&t.action.call(o,e,t)})}t="default"in t?t["default"]:t;var z=Object.prototype,N=Array.prototype,F=Function.prototype,M=z.toString,O=F.toString,j="";j+=O.call(Function),j=j.replace(/([.*+?^=!:$(){}|[\]\/\\])/g,"\\$1"),j=j.replace(/Function|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?"),j="^"+j+"$",j=new RegExp(j);var C={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#x22;","'":"&#x27;"},$=/\n|\r\n/g,I=t(window),P=t(document),H=Object.setPrototypeOf;r(H)||(H=!1);var L=Object.create;r(L)||(L=!1);var V=window.getComputedStyle,S=N.slice;p.prototype={on:function(t,e,n){var o=this,i=o.__events||(o.__events={});return n=arguments.length<3?o:n,(i[t]||(i[t]=[])).push({fn:e,context:n}),o},once:function(t,e,n){function o(){i.off(t,o),d(e,this,arguments)}var i=this;return i.on(t,o,n)},emit:function(t){for(var e,n,o,i=this,r=S.call(arguments,1),a=(i.__events||(i.__events={}))[t]||[],c=0,l=a.length;c<l;c++)e=d((n=a[c]).fn,n.context,r),!1!==o&&(o=e);return o},off:function(t,e,n){var o=this,i=arguments.length,r=o.__events||(o.__events={});switch(i){case 0:o.__events={};break;case 1:delete r[t];break;default:if(e){var a=r[t];if(a){n=i<3?o:n,i=a.length;for(var c,l=0;l<i;l++)if((c=a[l]).fn===e&&c.context===n){a.splice(l,1);break}a.length||delete r[t]}}}return o}};var W=1024,D={alloc:[],anchor:null,node:t('<div tabindex="0"></div>').css({top:0,left:0,width:"100%",height:"100%",position:"fixed"}),zIndex:function(t){t=Math.max(0,--t),D.node.css("z-index",t)},attach:function(t){var e=t.node,n=t.className+"-backdrop";D.node.attr("class",n).insertBefore(e)},show:function(t){if(D.attach(t),t!==D.anchor){var e=D.alloc,n=e.indexOf(t);-1!==n&&n===e.length-1||(-1!==n&&e.splice(n,1),e.push(t),D.anchor=t)}},hide:function(t){D.alloc=D.alloc.filter(function(e){return t!==e});var e=D.alloc.length;e?(t=D.alloc[e-1],D.zIndex(t.zIndex),D.attach(t)):(D.node.remove(),D.anchor=null)}},q={node:t('<div tabindex="0"></div>').css({top:0,left:0,width:0,height:0,zIndex:-1,opacity:0,position:"fixed"}),show:function(t){D.anchor&&q.node.insertAfter(t.node)},hide:function(){D.anchor||q.node.remove()}};m.active=null,P.on("focusin",function(t){var e=t.target,n=m.active,o=D.anchor;if(o)switch(e){case D.node[0]:n?n.focus():o.focus();break;case q.node[0]:o.focus()}else n&&e!==n.node&&!n.node.contains(e)&&n.blur()}),u(m,p,{node:null,destroyed:!0,open:!1,modal:!1,innerHTML:"",className:"ui-layer",constructor:m,focus:function(){var t=this;if(t.destroyed||!t.open)return t;var e=m.active;e&&e!==t&&e.blur();var n=t.node,o=t.__node,i=t.__getActive();if(n===i||n.contains(i)||t.__focus(o.find("[autofocus]")[0]||n),m.active!==t){var r=t.zIndex=v(!0);t.modal&&t!==D.anchor&&(t.__backdrop("show"),t.__backdrop("z-index",r)),o.css("zIndex",r),o.addClass(t.className+"-focus"),t.emit("focus"),m.active=t}return t},blur:function(){var t=this;return t.destroyed||!t.open?t:(t===m.active&&(m.active=null,t.__node.removeClass(t.className+"-focus"),t.emit("blur")),t)},__focus:function(t){try{/^iframe$/i.test(t.nodeName)||t.focus()}catch(e){}},__getActive:function(){try{var t=document.activeElement,e=t.contentDocument;return e&&e.activeElement||t}catch(n){}},__backdrop:function(t,e){var n=this;switch(t){case"show":case"hide":n.modal&&D[t](n),q[t](n);break;case"z-index":n.modal&&D.zIndex(e)}}});var K=document.documentElement.style,R={animation:"animationend",WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",KhtmlAnimation:"khtmlAnimationEnd"},U={transition:"transitionend",WebkitTransition:"webkitTransitionEnd",MozTransition:"mozTransitionEnd",OTransition:"oTransitionEnd",msTransition:"MSTransitionEnd",KhtmlTransition:"khtmlTransitionEnd"},X=b(R),B=b(U),Q=/\s+/;u(E,m,{returnValue:undefined,anchor:null,fixed:!1,align:"bottom left",className:"ui-dialog",constructor:E,__html:function(t){var e=this,n=e.__node;e.__innerHTML!==t&&(n.html(t),e.__innerHTML=t)},__show:function(t){var e=this;if(e.destroyed)return e;e.open=!0,e.anchor=t||null;var n=e.__node,o=e.className,i=o+" "+o+"-show";return e.modal&&(i+=" "+o+"-modal"),n.attr("role",e.modal?"alertdialog":"dialog").css("position",e.fixed?"fixed":"absolute").attr("class",i),e.__html(e.innerHTML),n.appendTo(document.body),e.__backdrop("show"),n.show(),e.reset(),e.emit("show"),e.focus(),e.__backdrop("z-index",e.zIndex),k(n,function(){e.emit("showed")}),e},show:function(t){var e=this;if(e.modal){e.__node;e.open&&e.__backdrop("hide")}return e.modal=!1,e.__show(t)},showModal:function(t){var e=this;e.__node;return e.modal=!0,e.__show(t)},close:function(t){var e=this;if(e.destroyed||!e.open)return e;if(!1===e.emit("beforeclose"))return e;t!==undefined&&(e.returnValue=t);e.node;var n=e.__node;return n.removeClass(e.className+"-show").addClass(e.className+"-close"),e.blur(),e.open=!1,e.emit("close"),k(n,function(){n.hide(),e.__backdrop("hide"),e.emit("closed")}),e},remove:function(){var t=this;if(t.destroyed)return t;if(!1===t.emit("beforeremove"))return t;t.blur(),t.__backdrop("hide"),t.__node.off().remove(),t.destroyed=!0,t.emit("remove");for(var e in t)delete t[e]},reset:function(){var t=this;if(t.destroyed||!t.open)return t;var e=t.__align;e&&(t.__node.removeClass(e),t.__align=null);var n=t.anchor;return n?t.__follow(n):t.__center(),t.emit("reset"),t},__center:function(){var t=this,e=t.__node,n=t.fixed,o=I.width(),i=I.height(),r=n?0:P.scrollLeft(),a=n?0:P.scrollTop(),c=e.outerWidth(),l=382*(i-e.outerHeight())/1e3+a,s=(o-c)/2+r;e.css({top:Math.max(parseFloat(l),a),left:Math.max(parseFloat(s),r)})},__follow:function(e){var n=this,o=n.__node;if(!(e=e.parentNode&&t(e))||!e.length)return n.__center();if(e&&(h=e.offset()).left*h.top<0)return n.__center();var i=n.fixed,r=I.width(),a=I.height(),c=P.scrollLeft(),l=P.scrollTop(),s=o.outerWidth(),u=o.outerHeight(),d=e?e.outerWidth():0,f=e?e.outerHeight():0,h=n.__offset(e[0]),p=h.left,_=h.top,v=i?p-c:p,m=i?_-l:_,b=i?0:l,g=i?0:c,y=b+a-u,w=g+r-s,x={},k=n.align.split(Q),E=n.className+"-",T={top:"bottom",bottom:"top",left:"right",right:"left"},A={top:"top",bottom:"top",left:"left",right:"left"},z=[{top:m-u,bottom:m+f,left:v-s,right:v+d},{top:m,bottom:m-u+f,left:v,right:v-s+d}],N={top:m+f/2-u/2,left:v+d/2-s/2},F={left:[g,w],top:[b,y]};k.forEach(function(t,e){z[e][t]>F[A[t]][1]&&(t=k[e]=T[t]),z[e][t]<F[A[t]][0]&&(k[e]=T[t])}),k[1]||(A[k[1]]="left"===A[k[0]]?"top":"left",z[1][k[1]]=N[A[k[1]]]),E+=k.join("-")+" "+n.className+"-follow",n.__align=E,o.addClass(E),x[A[k[0]]]=parseFloat(z[0][k[0]]),x[A[k[1]]]=parseFloat(z[1][k[1]]),o.css(x)},__offset:function(e){var n=e.parentNode,o=n?t(e).offset():{left:e.pageX,top:e.pageY},i=(e=n?e:e.target).ownerDocument,r=i.defaultView||i.parentWindow;if(r==window)return o;var a=r.frameElement,c=(i=t(i)).scrollLeft(),l=i.scrollTop(),s=t(a).offset(),u=s.left,d=s.top;return{top:o.top+d-l,left:o.left+u-c}}});var Y='<div class="ui-dialog-header"><div id="<%= @labelledby %>" class="ui-dialog-title" title="<%= @title.title %>"><%== @title.value %></div><div class="ui-dialog-controls"><% @controls.forEach(function(control, index) { %><a href="javascript:;" class="<%= control.className %>" title="<%= control.title || control.value %>" data-role="control" data-action-id="<%= index %>"<%= control.autofocus ? \' autofocus\' : \'\' %>><%== control.value %></a><% }); %></div></div><div id="<%= @describedby %>" class="ui-dialog-content" style="width:<%= @width %>; height:<%= @height %>"><%== @content %></div><div class="ui-dialog-buttons"><% @buttons.forEach(function(button, index) { %><button type="button" class="<%= button.className %>" title="<%= button.title || button.value %>" data-role="action" data-action-id="<%= index %>"<%= button.autofocus ? \' autofocus\' : \'\' %>><%== button.value %></button><% }); %></div>',G={},J={header:">.ui-dialog-header",title:">.ui-dialog-header>.ui-dialog-title",controls:">.ui-dialog-header>.ui-dialog-controls",content:">.ui-dialog-content",buttons:">.ui-dialog-buttons"},Z=Date.now(),tt="aria-title:<%= @id %>",et="aria-content:<%= @id %>",nt={id:null,title:{title:"",value:""},controls:[],buttons:[],width:"auto",height:"auto",fixed:!1,keyboard:!0,skin:"default",align:"bottom left"};return P.on("keydown",function(t){var e=m.active;if(e instanceof T&&!e.destroyed&&e.options.keyboard){var n=t.which,o=t.target,i=(e.className,e.panel("buttons")),r=e.panel("controls");if(13!==n||!i.contains(o)&&!r.contains(o)){var a=e.options;A(a.buttons,t,e),A(a.controls,t,e)}}}),u(T,E,{constructor:T,__show:function(t){var e=this;return e.destroyed?e:(e.className="ui-"+e.options.skin+"-dialog",E.prototype.__show.call(e,t))},__initContent:function(t){this.content=o(t)?t:""},__initOptions:function(e,n){this.options=e=t.extend({},n||nt,e);var i=e.title,r=e.controls,a=e.buttons,c=e.skin;o(i)&&(i={title:i,value:i}),e.title=i||nt.title,e.skin=c&&o(c)?c:nt.skin,e.width=h(e.width)||nt.which,e.height=h(e.height)||nt.height,e.buttons=Array.isArray(a)?a:nt.buttons,e.controls=Array.isArray(r)?r:nt.controls},__initEvents:function(){var e=this,o=J.buttons+">[data-role],"+J.controls+">[data-role]";e.__node.on("click",o,function(o){var i,r=t(this),a=e.options,c=r.attr("data-role"),l=r.attr("data-action-id");switch(c){case"control":i=a.controls[l];break;case"action":i=a.buttons[l]}i&&n(i.action)&&i.action.call(e,o,i)}),I.on("resize",e.__resize=function(){e.reset()})},__render:function(){var e=this,n=e.views,o=t.extend({},e.options,{content:e.content,labelledby:n.labelledby,describedby:n.describedby});e.innerHTML=n.frame(o)},panel:function(t){var e=this.__node;return"dialog"===t?e[0]:J.hasOwnProperty(t)?e.find(J[t])[0]:void 0},remove:function(){var t=this;if(!t.destroyed){var e=t.id,n=t.__resize;E.prototype.remove.call(t),t.destroyed&&(I.off("resize",n),G[e]&&delete G[e])}}}),{dialog:T,zIndex:function(t){return arguments.length?_(t):v()}}});
//# sourceMappingURL=dialog.js.map